{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/sara/Donepage/app/api/checkout/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport Stripe from \"stripe\";\n\nexport const runtime = \"nodejs\";\n\ntype Plan = \"starter\" | \"business\" | \"pro\";\n\nfunction getPriceId(plan: Plan) {\n  if (plan === \"starter\") return process.env.STRIPE_PRICE_STARTER;\n  if (plan === \"business\") return process.env.STRIPE_PRICE_BUSINESS;\n  if (plan === \"pro\") return process.env.STRIPE_PRICE_PRO;\n  return undefined;\n}\n\nexport async function POST(req: Request) {\n  try {\n    const secret = process.env.STRIPE_SECRET_KEY;\n\n    const bodyText = await req.text();\n    let body: any = null;\n    try {\n      body = bodyText ? JSON.parse(bodyText) : null;\n    } catch {}\n\n    const plan = body?.plan as Plan | undefined;\n\n    console.log(\"CHECKOUT_DEBUG\", {\n      hasSecret: !!secret,\n      plan,\n      priceStarter: process.env.STRIPE_PRICE_STARTER,\n      priceBusiness: process.env.STRIPE_PRICE_BUSINESS,\n      pricePro: process.env.STRIPE_PRICE_PRO,\n      appUrl: process.env.NEXT_PUBLIC_APP_URL,\n      nodeEnv: process.env.NODE_ENV,\n    });\n\n    if (!secret) {\n      return NextResponse.json({ error: \"Missing STRIPE_SECRET_KEY\" }, { status: 500 });\n    }\n\n    if (!plan || ![\"starter\", \"business\", \"pro\"].includes(plan)) {\n      return NextResponse.json({ error: \"Invalid plan\" }, { status: 400 });\n    }\n\n    const priceId = getPriceId(plan);\n    if (!priceId) {\n      return NextResponse.json(\n        { error: `Missing Stripe price id for plan: ${plan}` },\n        { status: 500 }\n      );\n    }\n\n    const stripe = new Stripe(secret);\n\n    const appUrl =\n      process.env.NEXT_PUBLIC_APP_URL ||\n      (process.env.VERCEL_URL ? `https://${process.env.VERCEL_URL}` : \"http://localhost:3000\");\n\n    const session = await stripe.checkout.sessions.create({\n      mode: \"payment\",\n      line_items: [{ price: priceId, quantity: 1 }],\n      metadata: { plan },\n      success_url: `${appUrl}/generator?paid=1&plan=${plan}&session_id={CHECKOUT_SESSION_ID}`,\n      cancel_url: `${appUrl}/generator?canceled=1`,\n    });\n\n    return NextResponse.json({ url: session.url });\n  } catch (err: any) {\n    console.error(\"CHECKOUT_ERROR_RAW\", err);\n    console.error(\"CHECKOUT_ERROR_MESSAGE\", err?.message);\n    console.error(\"CHECKOUT_ERROR_TYPE\", err?.type);\n    console.error(\"CHECKOUT_ERROR_CODE\", err?.code);\n    console.error(\"CHECKOUT_ERROR_STATUS\", err?.statusCode);\n    console.error(\"CHECKOUT_ERROR_PARAM\", err?.param);\n\n    return NextResponse.json(\n      { error: err?.message ?? \"Checkout failed\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,MAAM,UAAU;AAIvB,SAAS,WAAW,IAAU;IAC5B,IAAI,SAAS,WAAW,OAAO,QAAQ,GAAG,CAAC,oBAAoB;IAC/D,IAAI,SAAS,YAAY,OAAO,QAAQ,GAAG,CAAC,qBAAqB;IACjE,IAAI,SAAS,OAAO,OAAO,QAAQ,GAAG,CAAC,gBAAgB;IACvD,OAAO;AACT;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,SAAS,QAAQ,GAAG,CAAC,iBAAiB;QAE5C,MAAM,WAAW,MAAM,IAAI,IAAI;QAC/B,IAAI,OAAY;QAChB,IAAI;YACF,OAAO,WAAW,KAAK,KAAK,CAAC,YAAY;QAC3C,EAAE,OAAM,CAAC;QAET,MAAM,OAAO,MAAM;QAEnB,QAAQ,GAAG,CAAC,kBAAkB;YAC5B,WAAW,CAAC,CAAC;YACb;YACA,cAAc,QAAQ,GAAG,CAAC,oBAAoB;YAC9C,eAAe,QAAQ,GAAG,CAAC,qBAAqB;YAChD,UAAU,QAAQ,GAAG,CAAC,gBAAgB;YACtC,MAAM;YACN,OAAO;QACT;QAEA,IAAI,CAAC,QAAQ;YACX,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,IAAI,CAAC,QAAQ,CAAC;YAAC;YAAW;YAAY;SAAM,CAAC,QAAQ,CAAC,OAAO;YAC3D,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,UAAU,WAAW;QAC3B,IAAI,CAAC,SAAS;YACZ,OAAO,4JAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,CAAC,kCAAkC,EAAE,MAAM;YAAC,GACrD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,IAAI,+KAAM,CAAC;QAE1B,MAAM,SACJ,6DACA,CAAC,QAAQ,GAAG,CAAC,UAAU,GAAG,CAAC,QAAQ,EAAE,QAAQ,GAAG,CAAC,UAAU,EAAE,GAAG,uBAAuB;QAEzF,MAAM,UAAU,MAAM,OAAO,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;YACpD,MAAM;YACN,YAAY;gBAAC;oBAAE,OAAO;oBAAS,UAAU;gBAAE;aAAE;YAC7C,UAAU;gBAAE;YAAK;YACjB,aAAa,GAAG,OAAO,uBAAuB,EAAE,KAAK,iCAAiC,CAAC;YACvF,YAAY,GAAG,OAAO,qBAAqB,CAAC;QAC9C;QAEA,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,KAAK,QAAQ,GAAG;QAAC;IAC9C,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,sBAAsB;QACpC,QAAQ,KAAK,CAAC,0BAA0B,KAAK;QAC7C,QAAQ,KAAK,CAAC,uBAAuB,KAAK;QAC1C,QAAQ,KAAK,CAAC,uBAAuB,KAAK;QAC1C,QAAQ,KAAK,CAAC,yBAAyB,KAAK;QAC5C,QAAQ,KAAK,CAAC,wBAAwB,KAAK;QAE3C,OAAO,4JAAY,CAAC,IAAI,CACtB;YAAE,OAAO,KAAK,WAAW;QAAkB,GAC3C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}