{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/sara/Donepage/app/api/checkout/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport Stripe from \"stripe\";\n\nexport const runtime = \"nodejs\";\n\nconst stripeSecret = process.env.STRIPE_SECRET_KEY;\nif (!stripeSecret) {\n  throw new Error(\"Missing STRIPE_SECRET_KEY\");\n}\n\nconst stripe = new Stripe(stripeSecret);\n\nexport async function POST(req: Request) {\n  try {\n    const { plan } = (await req.json()) as { plan?: \"starter\" | \"business\" | \"pro\" };\n\n    if (!plan || ![\"starter\", \"business\", \"pro\"].includes(plan)) {\n      return NextResponse.json({ error: \"Invalid plan\" }, { status: 400 });\n    }\n\n    const priceMap: Record<\"starter\" | \"business\" | \"pro\", string | undefined> = {\n      starter: process.env.STRIPE_PRICE_STARTER,\n      business: process.env.STRIPE_PRICE_BUSINESS,\n      pro: process.env.STRIPE_PRICE_PRO,\n    };\n\n    const price = priceMap[plan];\n    if (!price) {\n      return NextResponse.json({ error: `Missing price id for plan: ${plan}` }, { status: 400 });\n    }\n\n    const baseUrl =\n      process.env.NEXT_PUBLIC_BASE_URL ||\n      process.env.NEXT_PUBLIC_APP_URL ||\n      \"https://donepage.co\";\n\n    const session = await stripe.checkout.sessions.create({\n      mode: \"payment\",\n      line_items: [{ price, quantity: 1 }],\n      metadata: { plan },\n      success_url: `${baseUrl}/?session_id={CHECKOUT_SESSION_ID}&paid=${plan}`,\n      cancel_url: `${baseUrl}/`,\n    });\n\n    return NextResponse.json({ url: session.url });\n  } catch (e: any) {\n    return NextResponse.json(\n      { error: e?.message ?? \"Checkout failed\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,MAAM,UAAU;AAEvB,MAAM,eAAe,QAAQ,GAAG,CAAC,iBAAiB;AAClD,IAAI,CAAC,cAAc;IACjB,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,SAAS,IAAI,+KAAM,CAAC;AAEnB,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,GAAI,MAAM,IAAI,IAAI;QAEhC,IAAI,CAAC,QAAQ,CAAC;YAAC;YAAW;YAAY;SAAM,CAAC,QAAQ,CAAC,OAAO;YAC3D,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,WAAuE;YAC3E,SAAS,QAAQ,GAAG,CAAC,oBAAoB;YACzC,UAAU,QAAQ,GAAG,CAAC,qBAAqB;YAC3C,KAAK,QAAQ,GAAG,CAAC,gBAAgB;QACnC;QAEA,MAAM,QAAQ,QAAQ,CAAC,KAAK;QAC5B,IAAI,CAAC,OAAO;YACV,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,CAAC,2BAA2B,EAAE,MAAM;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAC1F;QAEA,MAAM,UACJ,QAAQ,GAAG,CAAC,oBAAoB,IAChC,QAAQ,GAAG,CAAC,mBAAmB,IAC/B;QAEF,MAAM,UAAU,MAAM,OAAO,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;YACpD,MAAM;YACN,YAAY;gBAAC;oBAAE;oBAAO,UAAU;gBAAE;aAAE;YACpC,UAAU;gBAAE;YAAK;YACjB,aAAa,GAAG,QAAQ,wCAAwC,EAAE,MAAM;YACxE,YAAY,GAAG,QAAQ,CAAC,CAAC;QAC3B;QAEA,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,KAAK,QAAQ,GAAG;QAAC;IAC9C,EAAE,OAAO,GAAQ;QACf,OAAO,4JAAY,CAAC,IAAI,CACtB;YAAE,OAAO,GAAG,WAAW;QAAkB,GACzC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}